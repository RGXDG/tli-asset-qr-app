<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset QR Pro</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="data:application/manifest+json,{'name':'AssetQR','short_name':'AssetQR','start_url':'.','display':'standalone','background_color':'#ffffff','theme_color':'#2563eb'}" />
    
    <script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f9; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        h2 { text-align: center; color: #1e293b; margin-top: 0; }
        label { font-size: 0.8rem; color: #64748b; font-weight: bold; }
        input, select { width: 100%; padding: 10px; margin: 5px 0 12px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; background: #fff; font-size: 14px; }
        .specs-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        
        button { width: 100%; padding: 12px; margin-top: 8px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-gen { background: #2563eb; color: white; }
        .btn-save { background: #10b981; color: white; }
        .btn-print { background: #6366f1; color: white; }
        .btn-clear { background: #94a3b8; color: white; }
        .btn-test { background: #f59e0b; color: white; border: 2px dashed #b45309; margin-bottom: 15px; }
        
        #canvas { margin-top: 20px; display: flex; justify-content: center; }

        /* PRINT LOGIC: Hides everything except the QR code when printing */
        @media print {
            body { background: white; padding: 0; }
            .card, button, label, input, select, h2, hr { display: none !important; }
            #canvas { display: block !important; visibility: visible; position: absolute; left: 0; top: 0; width: 100%; text-align: center; }
            #canvas * { visibility: visible; }
        }
    </style>
</head>
<body>

<div class="card">
    <h2>Asset Tag Generator</h2>
    
    <button class="btn-test" onclick="randomizeData()">DEBUG: Randomize Data</button>

    <label>Manufacturer</label>
    <select id="make">
        <option value="">Select Make...</option>
        <option value="Dell">Dell</option>
        <option value="Lenovo">Lenovo</option>
        <option value="HP">HP</option>
        <option value="Apple">Apple</option>
        <option value="Not Specified">Not Specified</option>
    </select>

    <label>Model & OS</label>
    <input type="text" id="model" placeholder="Model (e.g. XPS 15)">
    <input type="text" id="os" placeholder="Operating System (e.g. Win 11)">
    
    <label>Serial Number</label>
    <input type="text" id="sn" placeholder="Serial Number">

    <label>Specifications</label>
    <div class="specs-grid">
        <select id="spec_cpu">
            <option value="">CPU</option>
            <option value="i5">i5</option>
            <option value="i7">i7</option>
            <option value="Mac">Mac</option>
            <option value="Ryzen">Ryzen</option>
        </select>
        <select id="spec_disk">
            <option value="">Disk</option>
            <option value="120GB">120GB</option>
            <option value="256GB">256GB</option>
            <option value="512GB">512GB</option>
            <option value="1TB">1TB</option>
            <option value="2TB">2TB</option>
        </select>
        <select id="spec_ram">
            <option value="">RAM</option>
            <option value="8GB">8GB</option>
            <option value="16GB">16GB</option>
            <option value="32GB">32GB</option>
            <option value="64GB">64GB</option>
        </select>
    </div>

    <label>Condition</label>
    <select id="condition">
        <option value="">Select Condition...</option>
        <option value="Fair">Fair</option>
        <option value="Good">Good</option>
        <option value="Excellent">Excellent</option>
    </select>

    <label>Volunteer Name</label>
    <input type="text" id="volunteer" placeholder="Your Name">
    
    <button class="btn-gen" onclick="generateQR()">Generate QR Code</button>
    <button class="btn-clear" onclick="clearForm()">Clear Form</button>
    
    <div id="canvas"></div>
    
    <div id="controls" style="display:none; text-align: center; margin-top: 10px;">
        <button class="btn-save" onclick="download('png')">Save as Image (PNG)</button>
        <button class="btn-print" onclick="window.print()">Print to PDF / Label</button>
    </div>
</div>

<script>
    let qrCode;

    function randomizeData() {
        const makes = ["Dell", "Lenovo", "HP", "Apple"];
        const oss = ["Windows 11", "macOS", "Linux"];
        const cpus = ["i5", "i7", "Mac", "Ryzen"];
        const disks = ["256GB", "512GB", "1TB"];
        const rams = ["8GB", "16GB", "32GB"];
        document.getElementById('make').value = makes[Math.floor(Math.random() * makes.length)];
        document.getElementById('model').value = "Latitude 7420";
        document.getElementById('os').value = oss[Math.floor(Math.random() * oss.length)];
        document.getElementById('sn').value = "SN-" + Math.random().toString(36).substring(2, 8).toUpperCase();
        document.getElementById('spec_cpu').value = cpus[Math.floor(Math.random() * cpus.length)];
        document.getElementById('spec_disk').value = disks[Math.floor(Math.random() * disks.length)];
        document.getElementById('spec_ram').value = rams[Math.floor(Math.random() * rams.length)];
        document.getElementById('condition').value = "Good";
        document.getElementById('volunteer').value = "Tester";
    }

    function clearForm() {
        ['make', 'model', 'os', 'sn', 'spec_cpu', 'spec_disk', 'spec_ram', 'condition', 'volunteer'].forEach(id => document.getElementById(id).value = "");
        document.getElementById("canvas").innerHTML = "";
        document.getElementById("controls").style.display = "none";
    }

    function generateQR() {
        const fields = {
            make: document.getElementById('make').value,
            model: document.getElementById('model').value.trim(),
            os: document.getElementById('os').value.trim(),
            sn: document.getElementById('sn').value.trim(),
            cpu: document.getElementById('spec_cpu').value,
            disk: document.getElementById('spec_disk').value,
            ram: document.getElementById('spec_ram').value,
            cond: document.getElementById('condition').value,
            vol: document.getElementById('volunteer').value.trim()
        };

        for (let key in fields) { if (!fields[key]) { alert("Please fill in all fields."); return; } }
        
        const dataString = `MAKE:${fields.make}|MOD:${fields.model}|OS:${fields.os}|SN:${fields.sn}|CPU:${fields.cpu}|SSD:${fields.disk}|RAM:${fields.ram}|COND:${fields.cond}|BY:${fields.vol}`;

        qrCode = new QRCodeStyling({
            width: 300, height: 300, data: dataString,
            dotsOptions: { color: "#000000", type: "square" },
            backgroundOptions: { color: "#ffffff" },
            errorCorrectionLevel: "H"
        });

        const canvasDiv = document.getElementById("canvas");
        canvasDiv.innerHTML = ""; 
        qrCode.append(canvasDiv);
        document.getElementById("controls").style.display = "block";
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    async function download(format) {
        if (!qrCode) return;
        qrCode.download({ name: `Asset-${document.getElementById('sn').value}`, extension: format });
    }

    // Register Service Worker for PWA Offline mode
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('data:application/javascript;base64,' + btoa("self.addEventListener('fetch', (e) => e.respondWith(fetch(e.request).catch(() => caches.match(e.request))));"));
    }
</script>

</body>
</html>
